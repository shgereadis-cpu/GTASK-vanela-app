<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G-Task ğŸ‡ªğŸ‡¹</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <link rel="stylesheet" href="style.css">
    <script>
        let BOT_USERNAME = 'GtaskProVanela_bot';
    </script>
</head>
<body>

    <div id="app-container">
        
        <header class="top-header">
            <h1 class="app-title" id="appTitle">ğŸ’š G-Task</h1>
            <div id="userBalance" class="balance-display">
                <span>ğŸ’°</span>
                <span class="balance-amount">0.00 ETB</span>
            </div>
        </header>

        <main class="content-area" id="contentArea">
            </main>

        <nav class="bottom-nav" id="bottomNav">
            <button class="nav-item active" data-page="tasks">âœ… G TASK</button>
            <button class="nav-item" data-page="earn">ğŸ Earn</button>
            <button class="nav-item" data-page="invite">ğŸ‘¥ Invite</button>
            <button class="nav-item" data-page="balance">ğŸ’° Balance</button>
            <button class="nav-item" data-page="withdraw">ğŸ’³ Withdraw</button>
        </nav>
    </div>

    <div id="channelJoinModalOverlay" class="admin-modal-overlay" style="display: none;">
        <div class="admin-modal" style="max-width: 400px;">
            <button class="close-modal-btn" id="closeChannelModal" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 24px; cursor: pointer;">âœ•</button>
            <h2>ğŸ’¬ á‰»áŠ“áˆ áŒ†á‹­áŠ•</h2>
            <div id="channelJoinContent" style="margin-top: 20px;">
                <div style="background: rgba(29, 184, 84, 0.1); border-left: 4px solid #1DB854; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="margin: 0; color: #A0AEC0; font-size: 14px; line-height: 1.6;">
                        <strong style="color: #1DB854;">1ï¸âƒ£ áˆµáˆáŒ£áŠ”</strong><br>áŠ¨á‰³á‰½ á‹«áˆˆá‹áŠ• á‰»áŠ“áˆ áŒ†á‹­áŠ• áŠ á‹áˆ«áˆ­ á‹­áŒ«áŠ‘á¢<br><br>
                        <strong style="color: #1DB854;">2ï¸âƒ£ áˆ›áˆ¨áŒ‹áŒˆáŒ¥</strong><br>á‰»áŠ“áˆ‰áŠ• áŠ¨á‰°á‰€áˆ‹á‰€áˆ‰ á‰ áŠ‹áˆ‹ "áˆ›áˆ¨áŒ‹áŒˆáŒ¥" á‹¨áˆšáˆˆá‹áŠ• á‹­áŒ«áŠ‘á¢<br><br>
                        <strong style="color: #1DB854;">3ï¸âƒ£ áˆ™á‹«</strong><br>á‹¨3 ETB áˆ™á‹« á‰³áŠ­á‰°á‹‹áˆ!
                    </p>
                </div>
                <button class="primary-button" id="openChannelBtn" style="width: 100%; margin-bottom: 12px;">ğŸ”— á‰»áŠ“áˆ‰áŠ• á‹­áŠ­áˆá‰±</button>
                <button class="primary-button accent-bg" id="verifyChannelBtn" style="width: 100%;">âœ… áˆ›áˆ¨áŒ‹áŒˆáŒ¥</button>
            </div>
        </div>
    </div>

    <div id="adminModalOverlay" class="admin-modal-overlay" style="display: none;">
        <div class="admin-modal">
            <h2>ğŸ” Admin Panel</h2>
            <div class="admin-login-form" id="adminLoginForm" style="display: none;">
                <input type="password" id="adminPassword" placeholder="Admin Password" class="form-input">
                <button class="primary-button" id="adminLoginBtn">áŒá‰£</button>
            </div>
            <div class="admin-panel" id="adminPanel" style="display: none;">
                <div class="admin-tabs">
                    <button class="admin-tab active" data-tab="credentials">ğŸ”‘ Credentials</button>
                    <button class="admin-tab" data-tab="pending">â³ Pending Tasks</button>
                    <button class="admin-tab" data-tab="withdrawals">ğŸ’³ Withdrawals</button>
                </div>

                <div class="admin-tab-content" id="credentialsTab" style="display: block;">
                    <h3>Gmail Credentials Pool</h3>
                    <div id="saveStatus" class="save-status" style="display: none;">âœ… á‰°á‰€áˆáŒ á‹‹áˆ</div>
                    <div class="admin-form">
                        <input type="text" id="adminFirstName" placeholder="áˆáˆ­áˆµá‰µ áŠ”áˆ" class="form-input">
                        <input type="text" id="adminLastName" placeholder="áˆ‹áˆµá‰µ áŠ”áˆ" class="form-input">
                        <input type="email" id="adminEmail" placeholder="Gmail Address" class="form-input">
                        <input type="text" id="adminGmailPassword" placeholder="Password" class="form-input">
                        <input type="email" id="adminRecoveryEmail" placeholder="Recovery Email" class="form-input">
                        <button class="primary-button" id="addCredentialBtn">âœ… áŒ¨áˆáˆ­</button>
                        <button class="primary-button" id="exportBtn" style="background-color: #FF9800; margin-top: 10px;">ğŸ“¥ á‹ˆáˆ¨á‹ˆáˆ­</button>
                    </div>
                    <div class="credentials-list">
                        <h4>Credentials Pool:</h4>
                        <div id="credentialsList"></div>
                    </div>
                </div>

                <div class="admin-tab-content" id="pendingTab" style="display: none;">
                    <h3>â³ Pending Tasks</h3>
                    <div id="pendingTasksList"></div>
                </div>

                <div class="admin-tab-content" id="withdrawalsTab" style="display: none;">
                    <h3>ğŸ’³ Withdrawal Requests</h3>
                    <div id="withdrawalsList"></div>
                </div>

                <button class="primary-button accent-bg" id="adminLogoutBtn" style="margin-top: 15px;">á‹áŒ£</button>
            </div>
            <button class="close-modal-btn" id="closeAdminModal" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 24px; cursor: pointer;">âœ•</button>
        </div>
    </div>

    <script>
        // ğŸš© á‹ˆáˆ³áŠá¡ á‹¨á‰´áˆŒáŒáˆ«áˆ SDK áˆ›áˆµáŒ€áˆ˜áˆªá‹«
        function initTelegramApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
                // á‹¨á‰´áˆŒáŒáˆ«áˆ áŒˆáŒ½á‰³ á‰€áˆˆáˆáŠ• áŠ¨áŠ¢á‰µá‹®áŒµá‹«á‹Šá‹ á‹³áˆ« áŒ‹áˆ­ áˆˆáˆ›áˆ˜áˆ³áˆ°áˆ
                const bgColor = '#F5F5F5'; 
                window.Telegram.WebApp.setBackgroundColor(bgColor);
                
                // Capture referral link start parameter from bot
                const initData = window.Telegram.WebApp.initDataUnsafe;
                if (initData && initData.start_param) {
                    handleReferralFromBot(initData.start_param);
                }
            }
        }

        // Handle referral when user opens mini app from bot referral link
        function handleReferralFromBot(startParam) {
            const currentUserId = getUserId();
            const storedReferrerId = localStorage.getItem('referrerId');
            
            // Only store referrer if this is a new user and they came from a referral link
            if (!storedReferrerId && startParam.startsWith('user_')) {
                localStorage.setItem('referrerId', startParam);
                
                // Increment the referrer's friend count
                const referrerFriendsCount = parseInt(localStorage.getItem(startParam + '_friendsCount') || '0');
                localStorage.setItem(startParam + '_friendsCount', (referrerFriendsCount + 1).toString());
            }
        }

        // Get referral stats for current user
        function getReferralStats() {
            const userId = getUserId();
            const friendsCount = parseInt(localStorage.getItem(userId + '_friendsCount') || '0');
            const referralEarnings = parseFloat(localStorage.getItem(userId + '_referralEarnings') || '0');
            return { friendsCount, referralEarnings };
        }
        
        // áŒˆáŒ¾á‰½áŠ• á‹¨áˆšá‰€á‹­áˆ­ á‰°áŒá‰£áˆ­ (á‰ Vanilla JS)
        function renderPage(pageName) {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = ''; // á‹«áˆˆá‹áŠ• á‹­á‹˜á‰µ á‰£á‹¶ áˆ›á‹µáˆ¨áŒ

            const navItems = document.querySelectorAll('.bottom-nav .nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            document.querySelector(`.nav-item[data-page="${pageName}"]`).classList.add('active');

            let contentHTML = '';

            if (pageName === 'tasks') {
                contentHTML = `
                    <div id="activeTaskArea"></div>
                    <div class="card task-card accent-border">
                        <h2>âœ… á‹¨áŒ‚áˆœáˆ áŠ áŠ«á‹áŠ•á‰µ áˆ˜áŠ­áˆá‰µ</h2>
                        <p>áŠ á‹²áˆµ á‹¨áŒ‚áˆœáˆ áŠ áŠ«á‹áŠ•á‰µ áŠ¨áá‰°á‹ á‰ á‰°áŒ á‰€áˆ±á‰µ áˆ˜áˆµáˆáˆ­á‰¶á‰½ áˆ˜áˆ áˆ¨á‰µ á‹«áˆµáˆ¨áŠ­á‰¡á¢ áˆˆáŠ¥á‹«áŠ•á‹³áŠ•á‹± á‰°á‰€á‰£á‹­áŠá‰µ áˆ‹áŒˆáŠ˜ áŠ áŠ«á‹áŠ•á‰µ **10.00 ETB** á‹«áŒˆáŠ›áˆ‰á¢</p>
                        <div class="instructions">
                            <h3>áˆ˜áˆ˜áˆªá‹«á‹á‰½:</h3>
                            <ul>
                                <li>1. áŠ áŠ«á‹áŠ•á‰±áŠ• áˆˆáˆ˜áŠ­áˆá‰µ áŠ á‹áˆ«áˆ©áŠ• á‹­áŒ«áŠ‘á¢</li>
                                <li>2. áŠ áŠ«á‹áŠ•á‰± áŠ¨á‰°áŠ¨áˆá‰° á‰ áŠ‹áˆ‹ "áŠ áˆµáˆ¨áŠ­á‰¥" á‹¨áˆšáˆˆá‹áŠ• á‹­áŒ«áŠ‘áŠ“ á‹¨áŠ¢áˆœá‹­áˆ‰áŠ• áˆµáˆ/áˆµáŠ­áˆªáŠ•áˆ»á‰µ á‹­áˆ‹áŠ©á¢</li>
                                <li>3. áˆ›áˆ¨áŒ‹áŒˆáŒ« áŠ¥áˆµáŠªáŒ áŠ“á‰€á‰… á‹­áŒ á‰¥á‰á¢</li>
                            </ul>
                        </div>
                        <button class="primary-button" id="getNewTaskButton">áŒ‚áˆœáˆ áŠ áŠ«á‹áŠ•á‰µ á‹­áŠ­áˆá‰±</button>
                    </div>
                    <div id="submissionArea" style="display: none;"></div>
                `;
                
                setTimeout(() => {
                    setupTaskAssignmentListener();
                }, 100);
            } else if (pageName === 'balance') {
                 const userBalance = parseFloat(localStorage.getItem('userBalance') || '0');
                 const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
                 let transactionsHTML = '';
                 
                 if (transactions.length === 0) {
                    transactionsHTML = '<div style="text-align: center; color: #A0AEC0; padding: 20px;">áˆáŠ•áˆ á‰°áŒá‰£áˆ­ áŒˆáŠ“ áŠ áˆá‰°á‰€á‰ áˆ‰áˆ</div>';
                 } else {
                    transactions.slice().reverse().slice(0, 5).forEach(tx => {
                        const isPositive = tx.type !== 'withdrawal';
                        const color = isPositive ? '#10B981' : '#FF6B5B';
                        const bgColor = isPositive ? 'rgba(16, 185, 129, 0.1)' : 'rgba(255, 107, 91, 0.1)';
                        const sign = isPositive ? '+' : '-';
                        transactionsHTML += `
                            <div style="background: ${bgColor}; border-left: 4px solid ${color}; border-radius: 8px; padding: 16px; transition: all 0.3s;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="color: ${color}; font-weight: 700; font-size: 15px;">${sign} ${tx.amount.toFixed(2)} ETB</div>
                                        <div style="color: #A0AEC0; font-size: 13px; margin-top: 4px;">${tx.type === 'task_completion' ? 'Task' : tx.type === 'daily_checkin' ? 'Daily Check-in' : 'Withdrawal'}</div>
                                    </div>
                                    <div style="color: #A0AEC0; font-size: 12px; background: ${isPositive ? 'rgba(16, 185, 129, 0.2)' : 'rgba(255, 107, 91, 0.2)'}; padding: 6px 12px; border-radius: 6px;">${tx.timestamp || 'á‹›áˆ¬'}</div>
                                </div>
                            </div>
                        `;
                    });
                 }
                 
                 contentHTML = `
                    <div class="card">
                        <h2>ğŸ’° á‹¨áŠ¥áˆ­áˆµá‹ áˆ‚áˆ³á‰¥</h2>
                        <div style="background: linear-gradient(135deg, rgba(29, 184, 84, 0.15) 0%, rgba(255, 184, 0, 0.08) 100%); border: 2px solid rgba(29, 184, 84, 0.4); border-radius: 16px; padding: 30px; text-align: center; margin: 20px 0;">
                            <div style="font-size: 14px; color: #A0AEC0; margin-bottom: 12px; letter-spacing: 1px;">áŒ á‰…áˆ‹áˆ‹ áˆ‚áˆ³á‰¥</div>
                            <div style="font-size: 42px; font-weight: 700; background: linear-gradient(135deg, #1DB854 0%, #FFB800 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 2px 8px rgba(29, 184, 84, 0.2);">${userBalance.toFixed(2)} <span style="font-size: 22px;">ETB</span></div>
                        </div>
                        <h3 style="color: #1DB854; margin-top: 24px; margin-bottom: 16px; font-size: 16px;">ğŸ“Š á‹¨á‰…áˆ­á‰¥ áŒŠá‹œ áŠ¥áŠ•á‰…áˆµá‰ƒáˆ´á‹á‰½:</h3>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            ${transactionsHTML}
                        </div>
                    </div>
                 `;
            } else if (pageName === 'earn') {
                 contentHTML = `
                    <div class="card">
                        <h2>ğŸ á‰°áŒ¨áˆáˆ­ áˆµáˆ«</h2>
                        <p>á‰°áŒ¨áˆáˆ­ áˆµáˆ«á‹áŠ• áŠ¥áŠ“ áˆŒáˆá‰½ á‰°áŒá‰£áˆ«á‰µ á‹­á‹ˆá‹±:</p>
                        <div class="earn-options">
                            <div class="earn-item">
                                <h3>ğŸ“º áˆ›áˆµá‰³á‹ˆá‰‚á‹« á‰°áˆ˜áˆáŠ¨á‰µ</h3>
                                <p>áŠ áŒ­áˆ­ áˆ›áˆµá‰³á‹ˆá‰‚á‹«á‹á‰½áŠ• á‹­áˆ˜áˆáŠ¨á‰±</p>
                                <span class="earn-reward">ğŸ’° 2.00 - 5.00 ETB</span>
                                <button class="primary-button" style="margin-top: 10px;">á‹­áŒ€áˆáˆ©</button>
                            </div>
                            <div class="earn-item">
                                <h3>âœ… Daily Check-in</h3>
                                <p>á‰ á‹¨á‰€áŠ‘ áŠ á•áˆŠáŠ¬áˆ½áŠ‘ á‹­áŒá‰¥áŠ™</p>
                                <span class="earn-reward">ğŸ’° 1.00 - 3.00 ETB</span>
                                <button class="primary-button daily-checkin-btn" style="margin-top: 10px;">á‹­áŒ€áˆáˆ©</button>
                            </div>
                            <div class="earn-item">
                                <h3>ğŸ’¬ á‰»áŠ“áˆ áŒ†á‹­áŠ•</h3>
                                <p>á‰»áŠ“áˆ‹á‰½áŠ• á‹­á‰€áˆ‹á‰€áˆ‰</p>
                                <span class="earn-reward">ğŸ’° 3.00 ETB</span>
                                <span style="display: inline-block; background: rgba(255, 184, 0, 0.2); border: 1px solid #FFB800; color: #FFB800; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; margin-top: 8px;">ğŸ”œ Coming Soon</span>
                                <button class="primary-button channel-join-btn" style="margin-top: 10px; opacity: 0.5; cursor: not-allowed;" disabled>á‹­áŒ€áˆáˆ©</button>
                            </div>
                            <div class="earn-item">
                                <h3>âœï¸ áˆµáˆ«á‹ˆá‰½ á‹«áˆ­á‰µá‹©</h3>
                                <p>á‹¨á‰°á‹°áˆ°á‰° áˆµáˆ«á‹ˆá‰½ á‹«áˆ­á‰µá‹© á‹ˆá‹° áŒˆáŠ•á‹˜á‰¥ á‹­á‰€áŠ•áˆ±</p>
                                <span class="earn-reward">ğŸ’° Variable</span>
                                <span style="display: inline-block; background: rgba(255, 184, 0, 0.2); border: 1px solid #FFB800; color: #FFB800; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; margin-top: 8px;">ğŸ”œ Coming Soon</span>
                                <button class="primary-button" style="margin-top: 10px; opacity: 0.5; cursor: not-allowed;" disabled>á‹­áŒ€áˆáˆ©</button>
                            </div>
                        </div>
                    </div>
                 `;
            } else if (pageName === 'invite') {
                 const userId = getUserId();
                 const referralLink = `https://t.me/${BOT_USERNAME}?start=${userId}`;
                 const stats = getReferralStats();
                 contentHTML = `
                    <div class="card">
                        <h2>ğŸ‘¥ Invite Friends & Earn</h2>
                        <p>Share your referral link and both of you will earn rewards!</p>
                        <div class="invite-section">
                            <div class="invite-stats">
                                <div class="stat-box">
                                    <span class="stat-number">${stats.friendsCount}</span>
                                    <span class="stat-label">ğŸ‘¥ Friends Invited</span>
                                </div>
                                <div class="stat-box">
                                    <span class="stat-number">${stats.referralEarnings.toFixed(2)} ETB</span>
                                    <span class="stat-label">ğŸ’¸ Referral Earnings</span>
                                </div>
                            </div>
                            <div class="invite-action">
                                <h3>ğŸ”— Your Referral Link</h3>
                                <div class="invite-link-box">
                                    <input type="text" id="referralLinkInput" value="${referralLink}" readonly class="form-input">
                                    <button class="primary-button copy-referral-btn" style="margin-top: 10px;">ğŸ“‹ Copy Link</button>
                                </div>
                                <div style="background: rgba(29, 184, 84, 0.1); border-left: 4px solid #1DB854; padding: 16px; margin-top: 20px; border-radius: 8px;">
                                    <h4 style="color: #1DB854; margin: 0 0 12px 0; font-size: 14px;">ğŸ“‹ How It Works:</h4>
                                    <ul style="list-style: none; margin: 0; padding: 0;">
                                        <li style="color: #A0AEC0; font-size: 13px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;"><span style="color: #1DB854;">âœ“</span> Share your link with friends</li>
                                        <li style="color: #A0AEC0; font-size: 13px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;"><span style="color: #1DB854;">âœ“</span> When they complete tasks, you earn 5% of their rewards</li>
                                        <li style="color: #A0AEC0; font-size: 13px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;"><span style="color: #1DB854;">âœ“</span> Example: If they earn 5 ETB, you get 0.25 ETB</li>
                                        <li style="color: #A0AEC0; font-size: 13px; display: flex; align-items: center; gap: 8px;"><span style="color: #1DB854;">âœ“</span> No limit to referrals - earn unlimited!</li>
                                    </ul>
                                </div>
                                <p style="font-size: 13px; color: #FFB800; margin-top: 20px; text-align: center; font-weight: 600;">ğŸ’° Earn 5% of each referral's task rewards</p>
                            </div>
                        </div>
                    </div>
                 `;
            } else if (pageName === 'withdraw') {
                 contentHTML = `
                    <div class="card">
                        <h2>ğŸ’³ áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ«</h2>
                        <p>áŒˆáŠ•á‹˜á‰¥á‹áŠ• á‰ á‰´áˆŒ á‰¥áˆ­ á‹ˆá‹­áˆ á‰ á‰£áŠ•áŠ­ áŠ áŠ«á‹áŠ•á‰µ áˆ›á‹áŒ£á‰µ á‹­á‰½áˆ‹áˆ‰á¢ á‹á‰…á‰°áŠ›á‹ á‹¨áˆ›á‹áŒ« áŒˆá‹°á‰¥ <strong style="color: #FFB800;">50.00 ETB</strong> áŠá‹á¢</p>
                        
                        <div style="background: rgba(29, 184, 84, 0.08); border: 1px solid rgba(29, 184, 84, 0.3); border-radius: 12px; padding: 20px; margin: 20px 0;">
                            <form id="withdrawForm" style="display: flex; flex-direction: column; gap: 16px;">
                                
                                <div style="display: flex; flex-direction: column;">
                                    <label style="font-size: 13px; font-weight: 600; color: #A0AEC0; margin-bottom: 8px;">ğŸ’° á‹¨áˆ›á‹áŒ£á‰µ áˆ˜áŒ áŠ• (ETB)</label>
                                    <input type="number" id="withdrawAmount" placeholder="50 á‹ˆá‹­áˆ áŠ¨á‹šá‹« á‰ áˆ‹á‹­" min="50" class="form-input" style="margin: 0;">
                                </div>

                                <div style="display: flex; flex-direction: column;">
                                    <label style="font-size: 13px; font-weight: 600; color: #A0AEC0; margin-bottom: 8px;">ğŸ“± áˆœá‰µá‹µ</label>
                                    <select id="withdrawMethod" class="form-input" style="margin: 0; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 10px; color: #fff;">
                                        <option value="">áˆœá‰µá‹µ á‹­áˆáˆ¨áŒ¡</option>
                                        <option value="telebirr">ğŸ“± á‰´áˆŒ á‰¥áˆ­ (Telebirr)</option>
                                        <option value="cbe">ğŸ¦ CBE (áŠ¢á‰µá‹®áŒµá‹« áŠ•áŒá‹µ á‰£áŠ•áŠ­)</option>
                                    </select>
                                </div>

                                <div style="display: flex; flex-direction: column;">
                                    <label style="font-size: 13px; font-weight: 600; color: #A0AEC0; margin-bottom: 8px;">ğŸ‘¤ á‹¨áŠ áŠ«á‹áŠ•á‰µ á‰£áˆˆá‰¤á‰µ áˆµáˆ</label>
                                    <input type="text" id="accountOwner" placeholder="áˆ™áˆ‰ áˆµáˆá‹áŠ• á‹«áˆµáŒˆá‰¡" class="form-input" style="margin: 0;">
                                </div>

                                <div style="display: flex; flex-direction: column;">
                                    <label style="font-size: 13px; font-weight: 600; color: #A0AEC0; margin-bottom: 8px;">ğŸ”¢ á‹¨áŠ áŠ«á‹áŠ•á‰µ á‰áŒ¥áˆ­</label>
                                    <input type="text" id="accountNumber" placeholder="áˆµáˆáŠ­ á‰áŒ¥áˆ­ á‹ˆá‹­áˆ á‰£áŠ•áŠ­ áŠ áŠ«á‹áŠ•á‰µ á‰áŒ¥áˆ­" class="form-input" style="margin: 0;">
                                </div>

                                <div style="background: rgba(255, 184, 0, 0.1); border-left: 4px solid #FFB800; padding: 12px; border-radius: 6px; margin-top: 8px;">
                                    <p style="margin: 0; font-size: 12px; color: #A0AEC0; line-height: 1.6;"><strong style="color: #FFB800;">âš ï¸ áˆ›áˆµá‰³á‹ˆáˆ»:</strong> áˆáˆ‰áŠ•áˆ ááˆ­áˆ á‰ á‰µáŠ­áŠ­áˆ á‹­áˆ™áˆ‰ á¢<br>áŠ­áá‹«á‹á‰½ áŠ¨1 - 24 áˆ°áŠ á‰³á‰µ á‹­áˆá€áˆ›áˆ‰ á¢</p>
                                </div>

                                <button type="submit" class="primary-button accent-bg" style="margin-top: 16px;">ğŸ’¸ áˆ›á‹áŒ£á‰µ á‹­áŒ á‹­á‰</button>
                            </form>
                        </div>
                    </div>
                 `;
            }
            contentArea.innerHTML = contentHTML;

            // Handle withdrawal form submission
            if (pageName === 'withdraw') {
                setTimeout(() => {
                    const withdrawForm = document.getElementById('withdrawForm');
                    if (withdrawForm) {
                        withdrawForm.addEventListener('submit', (e) => {
                            e.preventDefault();
                            
                            const amount = document.getElementById('withdrawAmount').value;
                            const method = document.getElementById('withdrawMethod').value;
                            const owner = document.getElementById('accountOwner').value;
                            const accountNum = document.getElementById('accountNumber').value;

                            if (!amount || !method || !owner || !accountNum) {
                                alert('âŒ áˆáˆ‰áˆ áˆ˜áˆµáŠ®á‰½ á‹­áˆ™áˆ‰');
                                return;
                            }

                            if (parseFloat(amount) < 50) {
                                alert('âŒ á‹á‰…á‰°áŠ›á‹ 50 ETB áŠá‹');
                                return;
                            }

                            const withdrawalRequest = {
                                id: 'wd_' + Date.now(),
                                amount: parseFloat(amount),
                                method: method,
                                owner: owner,
                                accountNumber: accountNum,
                                requestedAt: new Date().toLocaleString('am-ET'),
                                status: 'pending'
                            };

                            const withdrawals = JSON.parse(localStorage.getItem('withdrawalRequests') || '[]');
                            withdrawals.push(withdrawalRequest);
                            localStorage.setItem('withdrawalRequests', JSON.stringify(withdrawals));

                            alert('âœ… áŠ­áá‹« áŒ¥á‹«á‰„á‹ á‰°áˆ°áˆ­á‹á‹‹áˆ!\n\nâ³ áŠ¨1-24 áˆ°áŠ á‰³á‰µ á‹­áˆá€áˆ›áˆ‰');
                            withdrawForm.reset();
                        });
                    }
                }, 100);
            }

            // Handle Channel Join Task
            if (pageName === 'earn') {
                setTimeout(() => {
                    const channelJoinBtn = document.querySelector('.channel-join-btn');
                    if (channelJoinBtn) {
                        channelJoinBtn.addEventListener('click', () => {
                            openChannelJoinModal();
                        });
                    }
                    
                    const dailyCheckinBtn = document.querySelector('.daily-checkin-btn');
                    if (dailyCheckinBtn) {
                        dailyCheckinBtn.addEventListener('click', () => {
                            const lastCheckinTime = localStorage.getItem('lastDailyCheckinTime');
                            const now = Date.now();
                            const TWENTY_FOUR_HOURS = 24 * 60 * 60 * 1000;
                            
                            if (lastCheckinTime) {
                                const timeSinceLastCheckin = now - parseInt(lastCheckinTime);
                                if (timeSinceLastCheckin < TWENTY_FOUR_HOURS) {
                                    const hoursRemaining = Math.ceil((TWENTY_FOUR_HOURS - timeSinceLastCheckin) / (60 * 60 * 1000));
                                    alert(`âŒ á‰€áŒ áˆ® áŒŠá‹œ áŠ áˆá‹°áˆ¨áˆ°áˆ\n\nâ³ á‰ ${hoursRemaining} áˆ°áŠ á‰³á‰µ áˆáŠ­áˆ­`);
                                    return;
                                }
                            }
                            
                            const reward = Math.floor(Math.random() * 3) + 1;
                            const userBalance = parseFloat(localStorage.getItem('userBalance') || '0');
                            localStorage.setItem('userBalance', (userBalance + reward).toFixed(2));
                            localStorage.setItem('lastDailyCheckinTime', now.toString());
                            
                            const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
                            transactions.push({
                                type: 'daily_checkin',
                                amount: reward,
                                date: new Date().toLocaleString('am-ET')
                            });
                            localStorage.setItem('transactions', JSON.stringify(transactions));
                            
                            alert(`âœ… á‹á‹µá‹µáˆ­!\n\nğŸ’š ${reward.toFixed(2)} ETB á‰³áŠ­á‰°á‹‹áˆ`);
                            updateUserBalance();
                        });
                    }
                }, 100);
            }

            // Handle Referral Link Copy
            if (pageName === 'invite') {
                setTimeout(() => {
                    const copyBtn = document.querySelector('.copy-referral-btn');
                    const referralInput = document.getElementById('referralLinkInput');
                    if (copyBtn && referralInput) {
                        copyBtn.addEventListener('click', () => {
                            referralInput.select();
                            document.execCommand('copy');
                            const originalText = copyBtn.textContent;
                            copyBtn.textContent = 'âœ… Copied!';
                            setTimeout(() => {
                                copyBtn.textContent = originalText;
                            }, 2000);
                        });
                    }
                }, 100);
            }
        }

        // Admin State
        let isAdminLoggedIn = false;
        const ADMIN_PASSWORD = 'admin123';
        let currentUserIdForTask = null;
        let currentUserReferrerId = null;
        const CHANNEL_USERNAME = 'gtaskmanager'; // Channel to join
        const CHANNEL_JOIN_REWARD = 3.00;
        const TASK_TIMEOUT_MS = 60 * 60 * 1000; // 1 hour in milliseconds
        let taskTimerInterval = null;

        // Channel Join Modal Functions
        function openChannelJoinModal() {
            document.getElementById('channelJoinModalOverlay').style.display = 'flex';
            
            const openChannelBtn = document.getElementById('openChannelBtn');
            const verifyChannelBtn = document.getElementById('verifyChannelBtn');
            const closeChannelModal = document.getElementById('closeChannelModal');

            openChannelBtn.onclick = () => {
                const channelUrl = `https://t.me/${CHANNEL_USERNAME}`;
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.openLink(channelUrl);
                } else {
                    window.open(channelUrl, '_blank');
                }
            };

            verifyChannelBtn.onclick = () => {
                verifyChannelMembership();
            };

            closeChannelModal.onclick = () => {
                document.getElementById('channelJoinModalOverlay').style.display = 'none';
            };

            document.getElementById('channelJoinModalOverlay').addEventListener('click', (e) => {
                if (e.target === document.getElementById('channelJoinModalOverlay')) {
                    document.getElementById('channelJoinModalOverlay').style.display = 'none';
                }
            });
        }

        function verifyChannelMembership() {
            const verifyBtn = document.getElementById('verifyChannelBtn');
            const originalText = verifyBtn.textContent;
            verifyBtn.textContent = 'â³ áŒ£á‰¢á‹«...';
            verifyBtn.disabled = true;

            // Simulate verification with a delay
            setTimeout(() => {
                // Check if user already completed this task
                const channelJoinsTasks = JSON.parse(localStorage.getItem('channelJoinTasks') || '[]');
                const userIdForChannel = currentUserIdForTask || 'default_user';
                
                if (channelJoinsTasks.includes(userIdForChannel)) {
                    alert('âŒ á‹­áˆ… áˆµáˆ« á‰€á‹µáˆ á‰°áŒ áŠ“á‰…á‰‹áˆ');
                    verifyBtn.textContent = originalText;
                    verifyBtn.disabled = false;
                    return;
                }

                // Add to completed channel join tasks
                channelJoinsTasks.push(userIdForChannel);
                localStorage.setItem('channelJoinTasks', JSON.stringify(channelJoinsTasks));

                // Update user balance
                const currentBalance = parseFloat(localStorage.getItem('userBalance') || '0');
                const newBalance = currentBalance + CHANNEL_JOIN_REWARD;
                localStorage.setItem('userBalance', newBalance.toFixed(2));

                // Record transaction
                const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
                transactions.push({
                    type: 'channel_join',
                    amount: CHANNEL_JOIN_REWARD,
                    timestamp: new Date().toLocaleString('am-ET'),
                    status: 'completed'
                });
                localStorage.setItem('transactions', JSON.stringify(transactions));

                alert(`âœ… á‹á‹µá‹µáˆ­!\n\nğŸ’š ${CHANNEL_JOIN_REWARD} ETB á‰³áŠ­á‰°á‹‹áˆ`);
                document.getElementById('channelJoinModalOverlay').style.display = 'none';
                updateUserBalance();
                verifyBtn.textContent = originalText;
                verifyBtn.disabled = false;
            }, 1500);
        }

        // Gmail áˆ°áŠá‹µ áŠ­áˆá‰½á‰µ - áˆáˆ³áˆŒ áˆ°áŠá‹µ áˆˆáˆ™áŠ¨áˆ«
        function initializeSampleCredentials() {
            const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
            if (pool.length === 0) {
                const samples = [
                    { firstName: 'John', lastName: 'Doe', username: 'task.user.2024@gmail.com', password: 'SecurePass123' },
                    { firstName: 'Jane', lastName: 'Smith', username: 'gmail.task.001@gmail.com', password: 'Password456' },
                    { firstName: 'Ahmed', lastName: 'Hassan', username: 'account.setup.001@gmail.com', password: 'TaskPass789' }
                ];
                localStorage.setItem('gmailPool', JSON.stringify(samples));
            }
        }

        function getCredentialsFromPool() {
            const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
            if (pool.length === 0) {
                alert('âŒ áˆáŠ•áˆ áˆ°áŠá‹µ áŠ á‹­áŒˆáŠ™áˆ - admin áŠ­áˆá‰½á‰µ á‹­áˆ™áˆ‰');
                return null;
            }
            const randomIndex = Math.floor(Math.random() * pool.length);
            return pool[randomIndex];
        }

        function updateUserBalance() {
            const balance = parseFloat(localStorage.getItem('userBalance') || '0');
            const balanceAmount = document.querySelector('.balance-amount');
            if (balanceAmount) {
                balanceAmount.textContent = balance.toFixed(2) + ' ETB';
            }
        }

        function getUserId() {
            let userId = localStorage.getItem('userId');
            if (!userId) {
                userId = 'user_' + Math.random().toString(36).substr(2, 9) + Date.now();
                localStorage.setItem('userId', userId);
            }
            return userId;
        }

        // Apply referral commission when referred user completes task
        function applyReferralCommission(taskReward) {
            const referrerId = localStorage.getItem('referrerId');
            if (!referrerId) return; // No referrer, no commission
            
            const commission = (taskReward * 0.05).toFixed(2); // 5% commission
            const referralEarnings = parseFloat(localStorage.getItem(referrerId + '_referralEarnings') || '0');
            localStorage.setItem(referrerId + '_referralEarnings', (referralEarnings + parseFloat(commission)).toFixed(2));
        }

        // Admin Panel Functions
        function initAdminPanel() {
            const appTitle = document.getElementById('appTitle');
            let clickCount = 0;
            appTitle.addEventListener('click', () => {
                clickCount++;
                if (clickCount === 3) {
                    document.getElementById('adminModalOverlay').style.display = 'flex';
                    document.getElementById('adminLoginForm').style.display = 'block';
                    clickCount = 0;
                }
            });

            const adminLoginBtn = document.getElementById('adminLoginBtn');
            const adminPassword = document.getElementById('adminPassword');
            adminLoginBtn.addEventListener('click', () => {
                const enteredPassword = adminPassword.value.trim();
                if (enteredPassword === ADMIN_PASSWORD) {
                    isAdminLoggedIn = true;
                    document.getElementById('adminLoginForm').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    updateCredentialsList();
                } else {
                    alert('âŒ á‹ˆá‹° á‰°áˆ³áˆ³á‰° á“áˆµá‹ˆáˆ­á‹µ - admin123 á‹­áŒ á‰€áˆ™');
                    adminPassword.value = '';
                    adminPassword.focus();
                }
            });

            const addCredentialBtn = document.getElementById('addCredentialBtn');
            addCredentialBtn.addEventListener('click', () => {
                const firstName = document.getElementById('adminFirstName').value.trim();
                const lastName = document.getElementById('adminLastName').value.trim();
                const email = document.getElementById('adminEmail').value.trim();
                const password = document.getElementById('adminGmailPassword').value.trim();
                const recoveryEmail = document.getElementById('adminRecoveryEmail').value.trim();

                if (!firstName || !lastName || !email || !password) {
                    alert('âŒ áˆáˆ‰áŠ•áˆ áˆ˜áˆµáŠ®á‰½ á‹­áˆ™áˆ‰');
                    return;
                }

                const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
                pool.push({ firstName, lastName, username: email, password, recoveryEmail });
                localStorage.setItem('gmailPool', JSON.stringify(pool));

                document.getElementById('adminFirstName').value = '';
                document.getElementById('adminLastName').value = '';
                document.getElementById('adminEmail').value = '';
                document.getElementById('adminGmailPassword').value = '';
                document.getElementById('adminRecoveryEmail').value = '';
                updateCredentialsList();
                showSaveStatus();
            });

            const exportBtn = document.getElementById('exportBtn');
            exportBtn.addEventListener('click', () => {
                const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
                const dataStr = JSON.stringify(pool, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'gmail-credentials-backup.json';
                link.click();
                URL.revokeObjectURL(url);
            });

            document.getElementById('adminLogoutBtn').addEventListener('click', () => {
                isAdminLoggedIn = false;
                document.getElementById('adminLoginForm').style.display = 'block';
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminModalOverlay').style.display = 'none';
            });

            document.getElementById('closeAdminModal').addEventListener('click', () => {
                document.getElementById('adminModalOverlay').style.display = 'none';
                isAdminLoggedIn = false;
                document.getElementById('adminLoginForm').style.display = 'block';
                document.getElementById('adminPanel').style.display = 'none';
            });

            // Tab switching
            const adminTabs = document.querySelectorAll('.admin-tab');
            adminTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    adminTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    document.querySelectorAll('.admin-tab-content').forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    if (tabName === 'credentials') {
                        document.getElementById('credentialsTab').style.display = 'block';
                    } else if (tabName === 'pending') {
                        document.getElementById('pendingTab').style.display = 'block';
                        updatePendingTasksList();
                    } else if (tabName === 'withdrawals') {
                        document.getElementById('withdrawalsTab').style.display = 'block';
                        updateWithdrawalsList();
                    }
                });
            });
        }

        function updatePendingTasksList() {
            const pendingTasks = JSON.parse(localStorage.getItem('pendingTasks') || '[]');
            const listDiv = document.getElementById('pendingTasksList');
            listDiv.innerHTML = '';

            if (pendingTasks.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #999;">No pending tasks</p>';
                return;
            }

            pendingTasks.forEach((task, idx) => {
                const taskDiv = document.createElement('div');
                taskDiv.className = 'pending-task-item';
                taskDiv.innerHTML = `
                    <div style="margin-bottom: 15px; border: 2px solid #FFD700; padding: 15px; border-radius: 8px;">
                        <h4 style="margin-top: 0; color: var(--primary-color);">#${idx + 1} - ${task.email}</h4>
                        <p style="font-size: 13px; margin: 5px 0;">â° ${task.timestamp}</p>
                        <img src="${task.screenshot}" style="max-width: 100%; max-height: 200px; border-radius: 6px; margin: 10px 0;">
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button onclick="approvePendingTask('${task.id}')" class="primary-button" style="flex: 1; margin: 0;">âœ… áˆ›á…á‹°á‰…</button>
                            <button onclick="rejectPendingTask('${task.id}')" class="primary-button accent-bg" style="flex: 1; margin: 0; background: #f44336;">âŒ á‹á‹µá‰…</button>
                        </div>
                    </div>
                `;
                listDiv.appendChild(taskDiv);
            });
        }

        function approvePendingTask(taskId) {
            const pendingTasks = JSON.parse(localStorage.getItem('pendingTasks') || '[]');
            const taskIndex = pendingTasks.findIndex(t => t.id === taskId);
            if (taskIndex > -1) {
                const task = pendingTasks[taskIndex];
                const mainReward = 10.00;
                const referralBonus = mainReward * 0.05;
                
                // Remove from pending
                pendingTasks.splice(taskIndex, 1);
                localStorage.setItem('pendingTasks', JSON.stringify(pendingTasks));
                
                // Add to approved tasks for tracking
                const approvedTasks = JSON.parse(localStorage.getItem('approvedTasks') || '[]');
                approvedTasks.push({
                    ...task,
                    status: 'approved',
                    approvedAt: new Date().toLocaleString('am-ET'),
                    reward: mainReward
                });
                localStorage.setItem('approvedTasks', JSON.stringify(approvedTasks));
                
                // Update local balance
                const userBalance = parseFloat(localStorage.getItem('userBalance') || '0');
                localStorage.setItem('userBalance', (userBalance + mainReward).toFixed(2));
                
                alert('âœ… áˆ›á…á‹°á‰… á‰°á‹°áˆ­áŒ“áˆ!\nğŸ’° 10.00 ETB á‰°áˆ°áŒ¥á‰·áˆ\n\nğŸ“¢ Referrer earned: ' + referralBonus.toFixed(2) + ' ETB (5%)');
                updatePendingTasksList();
            }
        }

        function rejectPendingTask(taskId) {
            if (confirm('âŒ á‹­áˆ…áŠ• á‰³áˆµáŠ­ á‹á‹µá‰… áˆµá‰µáˆ áŠ¥áˆ­áŒáŒ áŠ› áŠáˆ…?')) {
                const pendingTasks = JSON.parse(localStorage.getItem('pendingTasks') || '[]');
                const taskIndex = pendingTasks.findIndex(t => t.id === taskId);
                if (taskIndex > -1) {
                    pendingTasks.splice(taskIndex, 1);
                    localStorage.setItem('pendingTasks', JSON.stringify(pendingTasks));
                    alert('âœ… á‰³áˆµáŠ­ á‹á‹µá‰… á‰°á‹°áˆ­áŒ“áˆ');
                    updatePendingTasksList();
                }
            }
        }

        function updateWithdrawalsList() {
            const withdrawals = JSON.parse(localStorage.getItem('withdrawalRequests') || '[]');
            const listDiv = document.getElementById('withdrawalsList');
            listDiv.innerHTML = '';

            if (withdrawals.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #999;">No withdrawal requests</p>';
                return;
            }

            withdrawals.forEach((wd, idx) => {
                const wdDiv = document.createElement('div');
                wdDiv.className = 'pending-task-item';
                const methodName = wd.method === 'telebirr' ? 'ğŸ“± Telebirr' : 'ğŸ¦ CBE';
                wdDiv.innerHTML = `
                    <div style="margin-bottom: 15px; border: 2px solid #FFB800; padding: 15px; border-radius: 8px;">
                        <h4 style="margin-top: 0; color: #FFB800;">#${idx + 1} - ${wd.owner}</h4>
                        <p style="font-size: 13px; margin: 5px 0;">ğŸ’° Amount: ${wd.amount} ETB</p>
                        <p style="font-size: 13px; margin: 5px 0;">ğŸ“± Method: ${methodName}</p>
                        <p style="font-size: 13px; margin: 5px 0;">ğŸ”¢ Account: ${wd.accountNumber}</p>
                        <p style="font-size: 13px; margin: 5px 0;">â° ${wd.requestedAt}</p>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button onclick="approveWithdrawal('${wd.id}')" class="primary-button" style="flex: 1; margin: 0;">âœ… Approve</button>
                            <button onclick="rejectWithdrawal('${wd.id}')" class="primary-button accent-bg" style="flex: 1; margin: 0; background: #f44336;">âŒ Reject</button>
                        </div>
                    </div>
                `;
                listDiv.appendChild(wdDiv);
            });
        }

        function approveWithdrawal(wdId) {
            const withdrawals = JSON.parse(localStorage.getItem('withdrawalRequests') || '[]');
            const index = withdrawals.findIndex(w => w.id === wdId);
            if (index > -1) {
                withdrawals[index].status = 'approved';
                localStorage.setItem('withdrawalRequests', JSON.stringify(withdrawals));
                alert('âœ… áŠ­áá‹« áˆˆáˆ°áŒ á‹!');
                updateWithdrawalsList();
            }
        }

        function rejectWithdrawal(wdId) {
            if (confirm('âŒ á‹­áˆ…áŠ• áŠ­áá‹« á‹á‹µá‰… áˆµá‰µáˆ áŠ¥áˆ­áŒáŒ áŠ› áŠáˆ…?')) {
                const withdrawals = JSON.parse(localStorage.getItem('withdrawalRequests') || '[]');
                const index = withdrawals.findIndex(w => w.id === wdId);
                if (index > -1) {
                    withdrawals.splice(index, 1);
                    localStorage.setItem('withdrawalRequests', JSON.stringify(withdrawals));
                    alert('âœ… áŠ­áá‹« á‹á‹µá‰… á‰°á‹°áˆ­áŒ“áˆ');
                    updateWithdrawalsList();
                }
            }
        }

        function updateCredentialsList() {
            const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
            const listDiv = document.getElementById('credentialsList');
            listDiv.innerHTML = '';
            pool.forEach((cred, idx) => {
                const item = document.createElement('div');
                item.className = 'credential-pool-item';
                item.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <p style="margin: 5px 0;"><strong>#${idx + 1}</strong> - ${cred.firstName} ${cred.lastName} (${cred.username})</p>
                        <button class="delete-btn" onclick="deleteCredential(${idx})" style="background: #ff5252; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">áˆ°áˆ­á‹¥</button>
                    </div>
                `;
                listDiv.appendChild(item);
            });
        }

        function deleteCredential(idx) {
            const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
            pool.splice(idx, 1);
            localStorage.setItem('gmailPool', JSON.stringify(pool));
            updateCredentialsList();
            showSaveStatus();
        }

        function showSaveStatus() {
            const statusDiv = document.getElementById('saveStatus');
            statusDiv.style.display = 'block';
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 2000);
        }

        // Task Timer Functions
        function startTaskTimer() {
            // Clear previous timer
            if (taskTimerInterval) clearInterval(taskTimerInterval);

            taskTimerInterval = setInterval(() => {
                const activeTask = JSON.parse(localStorage.getItem('activeTask') || '{}');
                if (!activeTask.assignedAt) return;

                const elapsedTime = Date.now() - activeTask.assignedAt;
                const remainingTime = TASK_TIMEOUT_MS - elapsedTime;
                
                const timerDiv = document.getElementById('taskTimer');
                if (timerDiv) {
                    if (remainingTime > 0) {
                        const minutes = Math.floor(remainingTime / 60000);
                        const seconds = Math.floor((remainingTime % 60000) / 1000);
                        timerDiv.textContent = `â±ï¸ ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    } else {
                        // Task expired
                        clearInterval(taskTimerInterval);
                        returnTaskToPool();
                    }
                }
            }, 1000);
        }

        function returnTaskToPool() {
            const activeTask = JSON.parse(localStorage.getItem('activeTask') || '{}');
            if (activeTask.credentials) {
                const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
                pool.push(activeTask.credentials);
                localStorage.setItem('gmailPool', JSON.stringify(pool));
            }
            
            localStorage.removeItem('activeTask');
            if (taskTimerInterval) clearInterval(taskTimerInterval);
            
            alert('âŒ á‰°áŒá‰£áˆ© á‹ˆá‹° áŠ­áˆá‰½á‰µ á‰°áˆ˜áˆ‹áˆ½ áˆ†áŠ“áˆ!\n\nâ° 1 áˆ°áŠ á‰µ á‹«áˆáŒ áŠ“á‰€á‰ á‰ á‰µáŠ­áŠ­áˆ');
            renderPage('tasks');
        }

        function checkForExpiredTask() {
            const activeTask = JSON.parse(localStorage.getItem('activeTask') || '{}');
            if (activeTask.assignedAt) {
                const elapsedTime = Date.now() - activeTask.assignedAt;
                if (elapsedTime > TASK_TIMEOUT_MS) {
                    returnTaskToPool();
                    return;
                }
            }
        }

        // áŠ á‹²áˆµ á‰°áŒá‰£áˆ­á¡ áŠ¨áŠ­áˆá‰½á‰µ á‰³áˆµáŠ­ áˆ˜á‹áˆ°á‹µ (Backend áŒ¥á‹«á‰„áŠ• áˆ›áˆµáˆ˜áˆµáˆ)
        function setupTaskAssignmentListener() {
            const getTaskButton = document.getElementById('getNewTaskButton');
            const activeTaskArea = document.getElementById('activeTaskArea');
            const submissionArea = document.getElementById('submissionArea');

            if (getTaskButton) {
                getTaskButton.addEventListener('click', () => {
                    // Admin Pool á‹áˆ‚á‰¥ - Gmail áˆ°áŠá‹µ
                    const credentials = getCredentialsFromPool();
                    if (!credentials) return;

                    // Store active task with timer
                    const activeTask = {
                        credentials: credentials,
                        assignedAt: Date.now()
                    };
                    localStorage.setItem('activeTask', JSON.stringify(activeTask));

                        activeTaskArea.innerHTML = `
                            <div class="card assigned-task-box">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                    <h3 style="color: var(--primary-color); margin: 0;">âœ… á‰°áŒá‰£áˆ­ á‰°áˆ°áŒ¥á‰¶á‹á‰³áˆ!</h3>
                                    <div style="background: rgba(255, 107, 91, 0.2); border: 1px solid #FF6B5B; border-radius: 6px; padding: 8px 12px; font-weight: 600; color: #FF6B5B;" id="taskTimer">â±ï¸ 60:00</div>
                                </div>
                                <div style="background: rgba(255, 184, 0, 0.1); border-left: 4px solid #FFB800; padding: 12px; margin-bottom: 16px; border-radius: 6px;">
                                    <p style="margin: 0; font-size: 13px; color: #A0AEC0;"><strong style="color: #FFB800;">âš ï¸ áˆ›áˆµá‰³á‹ˆáˆ»:</strong> á‹­áˆ…áŠ• á‰°áŒá‰£áˆ­ á‰ <strong>1 áˆ°áŠ á‰µ</strong> áˆ›áŒ áŠ“á‰€á‰… á‹­áŠ–áˆ­á‰¦á‰³áˆá¢ áŒŠá‹œá‹ áŠ¨á‰°áŠáˆ³ á‰°áŒá‰£áˆ© á‹ˆá‹° áŠ­áˆá‰½á‰µ á‹­áˆ˜áˆˆáˆ³áˆá¢</p>
                                </div>
                                <p>áŠ¨á‹šáˆ… á‰ á‰³á‰½ á‹«áˆ‰á‰µáŠ• áˆ°áŠá‹µ á‰°áŒ á‰…áˆ˜á‹ <strong>áŠ á‹²áˆµ á‹¨áŒ‚áˆœáˆ áŠ áŠ«á‹áŠ•á‰µ á‹­áŠ­áˆá‰±</strong>:</p>
                                <div class="credentials-display">
                                    <div class="credential-item">
                                        <label>ğŸ‘¤ First Name:</label>
                                        <div class="credential-value">${credentials.firstName}</div>
                                    </div>
                                    <div class="credential-item">
                                        <label>ğŸ‘¤ Last Name:</label>
                                        <div class="credential-value">${credentials.lastName}</div>
                                    </div>
                                    <div class="credential-item">
                                        <label>ğŸ“§ Gmail Address:</label>
                                        <div class="credential-value">${credentials.username}</div>
                                    </div>
                                    <div class="credential-item">
                                        <label>ğŸ” Password:</label>
                                        <div class="credential-value">${credentials.password}</div>
                                    </div>
                                </div>
                                <div class="instruction-box">
                                    <p><strong>ğŸ“ áˆ˜áˆ˜áˆªá‹«:</strong></p>
                                    <ol>
                                        <li>áŠ¨áˆ‹á‹­ á‹«áˆˆ áŒ‚áˆœáˆ áˆ°áŠá‹µ á‹­áŒˆáˆáŒˆáˆ‰ áŠ á‹²áˆµ áŠ áŠ«á‹áŠ•á‰µ áˆˆáˆ˜áŠ­áˆá‰µ</li>
                                        <li>áŠ áŠ«á‹áŠ•á‰± áŠ¨á‰°áŠ¨áˆá‰° á‰ áŠ‹áˆ‹ "áŠ áˆµáˆ¨áŠ­á‰¥" á‹¨áˆšáˆˆá‹áŠ• á‹­áŒ«áŠ‘áŠ“ á‹¨áŠ¢áˆœá‹­áˆ‰áŠ• áˆµáˆ/áˆµáŠ­áˆªáŠ•áˆ»á‰µ á‹­áˆ‹áŠ©</li>
                                    </ol>
                                </div>
                            </div>
                        `;
                        
                        submissionArea.innerHTML = `
                            <div class="submission-container">
                                <form id="taskSubmissionForm" style="display: flex; flex-direction: column; gap: 12px;">
                                    <div style="display: flex; flex-direction: column;">
                                        <label style="font-size: 13px; font-weight: 600; color: #A0AEC0; margin-bottom: 8px;">ğŸ“§ Gmail Account Name:</label>
                                        <div style="padding: 12px; background: rgba(29, 184, 84, 0.1); border: 1px solid rgba(29, 184, 84, 0.3); border-radius: 8px; color: #A0AEC0; font-size: 14px;">${credentials.firstName} ${credentials.lastName}</div>
                                    </div>
                                    <div class="screenshot-section">
                                        <h4>ğŸ“¸ áˆµáŠ­áˆªáŠ•áˆ»á‰µ á‹­áˆ‹áŠ©</h4>
                                        <p style="font-size: 13px; color: #666;">á‹¨áŒ‚áˆœáˆ áŠ áŠ«á‹áŠ•á‰± áŠ¨á‰°áŠ¨áˆá‰° áˆµáŠ­áˆªáŠ•áˆ»á‰µ á‹­áˆ‹áŠ©</p>
                                        <input type="file" id="screenshotInput" accept="image/*" class="form-input" style="margin: 10px 0;" required>
                                        <div id="screenshotPreview" style="margin: 10px 0;"></div>
                                    </div>
                                    <div style="display: flex; gap: 12px;">
                                        <button type="submit" class="primary-button submit-task-btn" id="submitTaskBtn" disabled style="flex: 1; opacity: 0.5; cursor: not-allowed;">âœ“ áŠ áˆµáˆ¨áŠ­á‰¥</button>
                                        <button type="button" class="primary-button" id="returnTaskBtn" style="flex: 1; background-color: #FF6B5B;">â†©ï¸ á‰°áˆ˜áˆ‹áˆ½</button>
                                    </div>
                                </form>
                            </div>
                        `;
                        
                    // á‹¨áˆ›áˆµáˆ¨áŠ¨á‰¢á‹« á‰…áŒ¹áŠ• áŠ¥áŠ“áˆ³á‹­
                    submissionArea.style.display = 'block';

                    // áˆµáŠ­áˆªáŠ•áˆ»á‰µ upload listener
                    const screenshotInput = document.getElementById('screenshotInput');
                    const submitBtn = document.getElementById('submitTaskBtn');
                    const taskForm = document.getElementById('taskSubmissionForm');
                    let screenshotUploaded = false;

                    if (screenshotInput) {
                        screenshotInput.addEventListener('change', (e) => {
                            const file = e.target.files[0];
                            if (file) {
                                screenshotUploaded = true;
                                const preview = document.getElementById('screenshotPreview');
                                const reader = new FileReader();
                                
                                reader.onload = (event) => {
                                    preview.innerHTML = `
                                        <div class="screenshot-preview">
                                            <img src="${event.target.result}" alt="Screenshot">
                                            <p style="margin-top: 8px; color: #4CAF50; font-weight: 600;">âœ… ${file.name} á‰°áˆáˆá‰·áˆ</p>
                                        </div>
                                    `;
                                };
                                reader.readAsDataURL(file);

                                // Submit button enable
                                submitBtn.disabled = false;
                                submitBtn.style.opacity = '1';
                                submitBtn.style.cursor = 'pointer';
                            }
                        });
                    }

                    // Start task timer
                    startTaskTimer();

                    // áŠ áˆµáˆ¨áŠ­á‰¥ á‹áˆ­á‹áˆ­ listener
                    if (taskForm) {
                        taskForm.addEventListener('submit', (e) => {
                            e.preventDefault();
                            
                            if (!screenshotUploaded) {
                                alert('âŒ áˆµáŠ­áˆªáŠ•áˆ»á‰µ á‹­áˆ‹áŠ©');
                                return;
                            }
                            
                            // Save to pending tasks
                            const screenshot = document.getElementById('screenshotInput').files[0];
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const pendingTasks = JSON.parse(localStorage.getItem('pendingTasks') || '[]');
                                const taskId = Date.now().toString();
                                pendingTasks.push({
                                    id: taskId,
                                    firstName: credentials.firstName,
                                    lastName: credentials.lastName,
                                    email: credentials.username,
                                    password: credentials.password,
                                    screenshot: e.target.result,
                                    timestamp: new Date().toLocaleString('am-ET'),
                                    status: 'pending'
                                });
                                localStorage.setItem('pendingTasks', JSON.stringify(pendingTasks));
                                localStorage.removeItem('activeTask');
                                if (taskTimerInterval) clearInterval(taskTimerInterval);
                                
                                alert('âœ… á‰°á‹ˆáˆµá‹·áˆ!\nâ³ Admin áˆ›á…á‹°á‰… á‹­áŒ á‰¥á‰...');
                                renderPage('tasks');
                            };
                            reader.readAsDataURL(screenshot);
                        });
                    }

                    // Return Task Button listener
                    const returnTaskBtn = document.getElementById('returnTaskBtn');
                    if (returnTaskBtn) {
                        returnTaskBtn.addEventListener('click', () => {
                            if (confirm('á‹­áˆ… á‰°áŒá‰£áˆ­ á‹ˆá‹° áŠ­áˆá‰½á‰µ á‰°áˆ˜áˆ‹áˆ½ áˆµá‰³á‹°áˆ­áŒ áŠ¥áˆ­áŒáŒ áŠ› áŠáˆ…?')) {
                                returnTaskToPool();
                            }
                        });
                    }
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initTelegramApp();
            initializeSampleCredentials();
            initAdminPanel();
            checkForExpiredTask();
            
            // á‹¨áŠ”á‰ªáŒŒáˆ½áŠ• áŠ á‹áˆ«áˆ­ áŠ­áˆŠáŠ­ á‰°á‰†áŒ£áŒ£áˆª
            const navButtons = document.querySelectorAll('.bottom-nav .nav-item');
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const page = button.getAttribute('data-page');
                    renderPage(page);
                });
            });

            // áˆ˜áŒ€áˆ˜áˆªá‹« áˆ‹á‹­ á‹¨Tasks áŒˆáŒ½áŠ• áŠ áˆ³á‹­
            renderPage('tasks');
            
            // áŠ á‹²áˆµ á‹¨á‰³áˆµáŠ­ áˆ˜á‹áˆ°áŒƒ listener
            setupTaskAssignmentListener();

            // Check for active task and restart timer
            const activeTask = JSON.parse(localStorage.getItem('activeTask') || '{}');
            if (activeTask.assignedAt) {
                startTaskTimer();
            }
        });
    </script>
</body>
</html>