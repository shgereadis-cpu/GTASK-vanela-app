<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G-Task Manager ­ЪЄф­ЪЄ╣</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="app-container">
        
        <header class="top-header">
            <h1 class="app-title" id="appTitle">G-Task Manager</h1>
            <div id="userBalance" class="balance-display">
                <span class="balance-amount">0.00 ETB</span>
            </div>
        </header>

        <main class="content-area" id="contentArea">
            </main>

        <nav class="bottom-nav" id="bottomNav">
            <button class="nav-item active" data-page="tasks">РюЁ рЅ░рїЇрЅБрѕФрЅх</button>
            <button class="nav-item" data-page="balance">­Ъњ░ рѕѓрѕ│рЅЦ</button>
            <button class="nav-item" data-page="withdraw">­Ъњ│ рѕЏрІЇрїФ</button>
        </nav>
    </div>

    <div id="adminModalOverlay" class="admin-modal-overlay" style="display: none;">
        <div class="admin-modal">
            <h2>­Ъћљ Admin Panel</h2>
            <div class="admin-login-form" id="adminLoginForm" style="display: none;">
                <input type="password" id="adminPassword" placeholder="Admin Password" class="form-input">
                <button class="primary-button" id="adminLoginBtn">рїЇрЅБ</button>
            </div>
            <div class="admin-panel" id="adminPanel" style="display: none;">
                <h3>Gmail Credentials Pool</h3>
                <div id="saveStatus" class="save-status" style="display: none;">РюЁ рЅ░рЅђрѕЮрїарІІрѕЇ</div>
                <div class="admin-form">
                    <input type="email" id="adminEmail" placeholder="Gmail Address" class="form-input">
                    <input type="text" id="adminGmailPassword" placeholder="Password" class="form-input">
                    <input type="email" id="adminRecoveryEmail" placeholder="Recovery Email" class="form-input">
                    <button class="primary-button" id="addCredentialBtn">РюЁ рїерѕЮрѕГ</button>
                    <button class="primary-button" id="exportBtn" style="background-color: #FF9800; margin-top: 10px;">­ЪЊЦ рІѕрѕерІѕрѕГ</button>
                </div>
                <div class="credentials-list">
                    <h4>Credentials Pool:</h4>
                    <div id="credentialsList"></div>
                </div>
                <button class="primary-button accent-bg" id="adminLogoutBtn" style="margin-top: 15px;">рІЇрїБ</button>
            </div>
            <button class="close-modal-btn" id="closeAdminModal" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 24px; cursor: pointer;">РюЋ</button>
        </div>
    </div>

    <script>
        // ­ЪџЕ рІѕрѕ│ріЮрЇА рІерЅ┤рѕїрїЇрѕФрѕЮ SDK рѕЏрѕхрїђрѕўрѕфрІФ
        function initTelegramApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
                // рІерЅ┤рѕїрїЇрѕФрѕЮ рїѕрїйрЅ│ рЅђрѕѕрѕЮріЋ ріерібрЅхрІ«рїхрІФрІірІЇ рІ│рѕФ рїІрѕГ рѕѕрѕЏрѕўрѕ│рѕ░рѕЇ
                const bgColor = '#F5F5F5'; 
                window.Telegram.WebApp.setBackgroundColor(bgColor);
            }
        }
        
        // рїѕрїЙрЅйріЋ рІерѕџрЅђрІГрѕГ рЅ░рїЇрЅБрѕГ (рЅаVanilla JS)
        function renderPage(pageName) {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = ''; // рІФрѕѕрІЇріЋ рІГрІўрЅх рЅБрІХ рѕЏрІхрѕерїЇ

            const navItems = document.querySelectorAll('.bottom-nav .nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            document.querySelector(`.nav-item[data-page="${pageName}"]`).classList.add('active');

            let contentHTML = '';

            if (pageName === 'tasks') {
                contentHTML = `
                    <div id="activeTaskArea"></div>
                    <div class="card task-card accent-border">
                        <h2>РюЁ рІерїѓрѕюрѕЇ ріаріФрІЇріЋрЅх рѕўріГрЇѕрЅх</h2>
                        <p>ріарІ▓рѕх рІерїѓрѕюрѕЇ ріаріФрІЇріЋрЅх ріерЇЇрЅ░рІЇ рЅарЅ░рїарЅђрѕ▒рЅх рѕўрѕхрЇѕрѕГрЅХрЅй рѕўрѕарѕерЅх рІФрѕхрѕеріГрЅАрЇб рѕѕріЦрІФріЋрІ│ріЋрІ▒ рЅ░рЅђрЅБрІГріљрЅх рѕІрїѕріў ріаріФрІЇріЋрЅх **5.00 ETB** рІФрїѕріЏрѕЅрЇб</p>
                        <div class="instructions">
                            <h3>рѕўрѕўрѕфрІФрІјрЅй:</h3>
                            <ul>
                                <li>1. ріаріФрІЇріЋрЅ▒ріЋ рѕѕрѕўріГрЇѕрЅх ріарІЮрѕФрѕЕріЋ рІГрїФріЉрЇб</li>
                                <li>2. ріаріФрІЇріЋрЅ▒ ріерЅ░ріерЇѕрЅ░ рЅаріІрѕІ "ріарѕхрѕеріГрЅЦ" рІерѕџрѕѕрІЇріЋ рІГрїФріЉріЊ рібрѕюрІГрѕЅріЋ/рІерІГрѕѕрЇЇ рЅЃрѕЅріЋ рІГрѕІріЕрЇб</li>
                                <li>3. рѕЏрѕерїІрїѕрїФ ріЦрѕхріфрїаріЊрЅђрЅЁ рІГрїарЅЦрЅЂрЇб</li>
                            </ul>
                        </div>
                        <button class="primary-button" id="getNewTaskButton">рїѓрѕюрѕЇ ріаріФрІЇріЋрЅх рІГріГрЇѕрЅ▒</button>
                    </div>
                    <div id="submissionArea" style="display: none;"></div>
                `;
            } else if (pageName === 'balance') {
                 contentHTML = `
                    <div class="card">
                        <h2>­Ъњ░ рІеріЦрѕГрѕхрІј рѕѓрѕ│рЅЦ</h2>
                        <div class="balance-large">
                            <strong>125.00</strong> <small>ETB</small>
                        </div>
                        <p class="history-title">рІерЅЁрѕГрЅЦ рїірІю ріЦріЋрЅЁрѕхрЅЃрѕ┤рІјрЅй:</p>
                        <ul class="history-list">
                            <li>+5.00 ETB (Task #123) - рІЏрѕг</li>
                            <li>-50.00 ETB (рІѕрїф) - рЅхріЊріЋрЅх</li>
                            <li>+10.00 ETB (Task #125) - ріерЅхріЊріЋрЅх рІѕрІ▓рІФ</li>
                        </ul>
                    </div>
                 `;
            } else if (pageName === 'withdraw') {
                 contentHTML = `
                    <div class="card">
                        <h2>­Ъњ│ рїѕріЋрІўрЅЦ рѕЏрІЇрїФ</h2>
                        <p>рїѕріЋрІўрЅЦрІјріЋ рЅарЅ┤рѕї рЅЦрѕГ рІѕрІГрѕЮ рЅарЅБріЋріГ ріаріФрІЇріЋрЅх рѕЏрІЇрїБрЅх рІГрЅйрѕІрѕЅрЇб рІЮрЅЁрЅ░ріЏрІЇ рІерѕЏрІЇрїФ рїѕрІ░рЅЦ **50.00 ETB** ріљрІЇрЇб</p>
                        <input type="number" placeholder="рІерѕЏрІЇрїБрЅх рѕўрїаріЋ рІФрѕхрїѕрЅА (рѕѕрѕЮрѕ│рѕї 50)">
                        <button class="primary-button accent-bg">рѕЏрІЇрїБрЅх рІГрїарІГрЅЂ</button>
                    </div>
                 `;
            }
            contentArea.innerHTML = contentHTML;
        }

        // Admin State
        let isAdminLoggedIn = false;
        const ADMIN_PASSWORD = 'admin123';

        // Gmail рѕ░ріљрІх ріГрѕЮрЅйрЅх - рѕЮрѕ│рѕї рѕ░ріљрІх рѕѕрѕЎріерѕФ
        function initializeSampleCredentials() {
            const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
            if (pool.length === 0) {
                const samples = [
                    { username: 'task.user.2024@gmail.com', password: 'SecurePass123', recovery: 'recovery.email@yahoo.com' },
                    { username: 'gmail.task.001@gmail.com', password: 'Password456', recovery: 'backup.email@outlook.com' },
                    { username: 'account.setup.001@gmail.com', password: 'TaskPass789', recovery: 'alternative@mail.com' }
                ];
                localStorage.setItem('gmailPool', JSON.stringify(samples));
            }
        }

        function getCredentialsFromPool() {
            const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
            if (pool.length === 0) {
                alert('РЮї рѕЮріЋрѕЮ рѕ░ріљрІх ріарІГрїѕріЎрѕЮ - admin ріГрѕЮрЅйрЅх рІГрѕЎрѕЅ');
                return null;
            }
            const randomIndex = Math.floor(Math.random() * pool.length);
            return pool[randomIndex];
        }

        // Admin Panel Functions
        function initAdminPanel() {
            const appTitle = document.getElementById('appTitle');
            let clickCount = 0;
            appTitle.addEventListener('click', () => {
                clickCount++;
                if (clickCount === 3) {
                    document.getElementById('adminModalOverlay').style.display = 'flex';
                    document.getElementById('adminLoginForm').style.display = 'block';
                    clickCount = 0;
                }
            });

            const adminLoginBtn = document.getElementById('adminLoginBtn');
            const adminPassword = document.getElementById('adminPassword');
            adminLoginBtn.addEventListener('click', () => {
                const enteredPassword = adminPassword.value.trim();
                if (enteredPassword === ADMIN_PASSWORD) {
                    isAdminLoggedIn = true;
                    document.getElementById('adminLoginForm').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    updateCredentialsList();
                } else {
                    alert('РЮї рІѕрІ░ рЅ░рѕ│рѕ│рЅ░ рЇЊрѕхрІѕрѕГрІх - admin123 рІГрїарЅђрѕЎ');
                    adminPassword.value = '';
                    adminPassword.focus();
                }
            });

            const addCredentialBtn = document.getElementById('addCredentialBtn');
            addCredentialBtn.addEventListener('click', () => {
                const email = document.getElementById('adminEmail').value.trim();
                const password = document.getElementById('adminGmailPassword').value.trim();
                const recovery = document.getElementById('adminRecoveryEmail').value.trim();

                if (!email || !password || !recovery) {
                    alert('РЮї рѕЂрѕЅріЋрѕЮ рѕўрѕхрі«рЅй рІГрѕЎрѕЅ');
                    return;
                }

                const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
                pool.push({ username: email, password, recovery });
                localStorage.setItem('gmailPool', JSON.stringify(pool));

                document.getElementById('adminEmail').value = '';
                document.getElementById('adminGmailPassword').value = '';
                document.getElementById('adminRecoveryEmail').value = '';
                updateCredentialsList();
                showSaveStatus();
            });

            const exportBtn = document.getElementById('exportBtn');
            exportBtn.addEventListener('click', () => {
                const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
                const dataStr = JSON.stringify(pool, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'gmail-credentials-backup.json';
                link.click();
                URL.revokeObjectURL(url);
            });

            document.getElementById('adminLogoutBtn').addEventListener('click', () => {
                isAdminLoggedIn = false;
                document.getElementById('adminLoginForm').style.display = 'block';
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminModalOverlay').style.display = 'none';
            });

            document.getElementById('closeAdminModal').addEventListener('click', () => {
                document.getElementById('adminModalOverlay').style.display = 'none';
                isAdminLoggedIn = false;
                document.getElementById('adminLoginForm').style.display = 'block';
                document.getElementById('adminPanel').style.display = 'none';
            });
        }

        function updateCredentialsList() {
            const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
            const listDiv = document.getElementById('credentialsList');
            listDiv.innerHTML = '';
            pool.forEach((cred, idx) => {
                const item = document.createElement('div');
                item.className = 'credential-pool-item';
                item.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <p style="margin: 5px 0;"><strong>#${idx + 1}</strong> - ${cred.username}</p>
                        <button class="delete-btn" onclick="deleteCredential(${idx})" style="background: #ff5252; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">рѕ░рѕГрІЦ</button>
                    </div>
                `;
                listDiv.appendChild(item);
            });
        }

        function deleteCredential(idx) {
            const pool = JSON.parse(localStorage.getItem('gmailPool') || '[]');
            pool.splice(idx, 1);
            localStorage.setItem('gmailPool', JSON.stringify(pool));
            updateCredentialsList();
            showSaveStatus();
        }

        function showSaveStatus() {
            const statusDiv = document.getElementById('saveStatus');
            statusDiv.style.display = 'block';
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 2000);
        }

        // ріарІ▓рѕх рЅ░рїЇрЅБрѕГрЇА ріеріГрѕЮрЅйрЅх рЅ│рѕхріГ рѕўрІЇрѕ░рІх (Backend рїЦрІФрЅёріЋ рѕЏрѕхрѕўрѕхрѕЇ)
        function setupTaskAssignmentListener() {
            const getTaskButton = document.getElementById('getNewTaskButton');
            const activeTaskArea = document.getElementById('activeTaskArea');
            const submissionArea = document.getElementById('submissionArea');

            if (getTaskButton) {
                getTaskButton.addEventListener('click', () => {
                    // Admin Pool рІЇрѕѓрЅЦ - Gmail рѕ░ріљрІх
                    const credentials = getCredentialsFromPool();
                    if (!credentials) return;

                        activeTaskArea.innerHTML = `
                            <div class="card assigned-task-box">
                                <h3 style="color: var(--primary-color);">РюЁ рЅ░рїЇрЅБрѕГ рЅ░рѕ░рїЦрЅХрІјрЅ│рѕЇ!</h3>
                                <p>ріерІџрѕЁ рЅарЅ│рЅй рІФрѕЅрЅхріЋ рѕ░ріљрІх рЅ░рїарЅЁрѕўрІЇ <strong>ріарІ▓рѕх рІерїѓрѕюрѕЇ ріаріФрІЇріЋрЅх рІГріГрЇѕрЅ▒</strong>:</p>
                                <div class="credentials-display">
                                    <div class="credential-item">
                                        <label>­ЪЊД рїѓрѕюрѕЇ рѕ░ріљрІх:</label>
                                        <div class="credential-value">${credentials.username}</div>
                                    </div>
                                    <div class="credential-item">
                                        <label>­Ъћљ рІерІГрѕѕрЇЇ рЅЃрѕЇ:</label>
                                        <div class="credential-value">${credentials.password}</div>
                                    </div>
                                    <div class="credential-item">
                                        <label>­Ъњї рѕЏрїѕрїѕрѕџрІФ рібрѕюрІГрѕЇ:</label>
                                        <div class="credential-value">${credentials.recovery}</div>
                                    </div>
                                </div>
                                <div class="instruction-box">
                                    <p><strong>­ЪЊЮ рѕўрѕўрѕфрІФ:</strong></p>
                                    <ol>
                                        <li>рѕІрІГ рІФрѕѕ рїѓрѕюрѕЇ рѕ░ріљрІх рІГрїѕрѕЇрїѕрѕЅ ріарІ▓рѕх ріаріФрІЇріЋрЅх рѕѕрѕўріГрЇѕрЅх</li>
                                        <li>рѕЏрїѕрїѕрѕџрІФ рібрѕюрІГрѕЇріЋ рІ░рїЇрѕъ рІГрїарЅђрѕЎ</li>
                                        <li>ріаріФрІЇріЋрЅ▒ ріерЅ░ріерЇѕрЅ░ рЅаріІрѕІ "ріарѕхрѕеріГрЅЦ" рІГрїФріЉ</li>
                                    </ol>
                                </div>
                            </div>
                        `;
                        
                        submissionArea.innerHTML = `
                            <div class="submission-container">
                                <button class="primary-button submit-task-btn" id="submitTaskBtn">РюЊ ріарѕхрѕеріГрЅЦ</button>
                            </div>
                        `;
                        
                    // рІерѕЏрѕхрѕеріерЅбрІФ рЅЁрї╣ріЋ ріЦріЊрѕ│рІГ
                    submissionArea.style.display = 'block';

                    // ріарѕхрѕеріГрЅЦ рЅЂрѕЇрЇЇ listener
                    const submitBtn = document.getElementById('submitTaskBtn');
                    if (submitBtn) {
                        submitBtn.addEventListener('click', () => {
                            // Backend рїЦрІФрЅё - рѕѓрѕ│рЅЦ рѕЏрѕхрїѕрЅбрІФ
                            alert('РюЁ рЅ░рІѕрѕхрІирѕЇ!\n­Ъњ░ 5.00 ETB рѕѓрѕ│рЅЦрІј рѕІрІГ рЅ│ріГрѕЈрѕЇрЇб');
                            
                            // рѕѓрІ░рЅ▒ріЋ рІ│рїЇрѕЮ рїђрѕЮрѕГ
                            renderPage('tasks');
                        });
                    }
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initTelegramApp();
            initializeSampleCredentials();
            initAdminPanel();
            
            // рІеріћрЅфрїїрѕйріЋ ріарІЮрѕФрѕГ ріГрѕіріГ рЅ░рЅєрїБрїБрѕф
            const navButtons = document.querySelectorAll('.bottom-nav .nav-item');
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const page = button.getAttribute('data-page');
                    renderPage(page);
                });
            });

            // рѕўрїђрѕўрѕфрІФ рѕІрІГ рІеTasks рїѕрїйріЋ ріарѕ│рІГ
            renderPage('tasks');
            
            // ріарІ▓рѕх рІерЅ│рѕхріГ рѕўрІЇрѕ░рїЃ listener
            setupTaskAssignmentListener();
        });
    </script>
</body>
</html>